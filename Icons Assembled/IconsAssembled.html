<div class="grid col1 gap">
    <h1 class="grid col1 charname box">
        <input type="text" name="attr_character_name" />
    </h1>

    <div class="grid col3 gap origin">
        <div class="grid col1 box">
            <h2>Origin</h2>
            <select name="attr_origin">
                <option value="">Choose</option>
                <option value="Trained">Trained</option>
                <option value="Transformed">Transformed</option>
                <option value="Birthright">Birthright</option>
                <option value="Gimmick">Gimmick</option>
                <option value="Artificial">Artificial</option>
                <option value="Unearthly">Unearthly</option>
            </select>
        </div>
        <div class="grid col1 stat box">
            <h2>Determination</h2>
            <div class="grid col3 smallgap">
                <input type="number" name="attr_determination" />
                <span class="input">/</span>
                <input type="number" name="attr_determination_max" />
            </div>
        </div>
        <div class="grid col1 stat box">
            <h2>Stamina</h2>
            <div class="grid col3 smallgap">
                <input type="number" name="attr_stamina" value="0" />
                <span class="input">/</span>
                <span class="input" name="attr_stamina_max" />
            </div>
        </div>
    </div>

    <div class="grid col2 stats gap">
        <div class="grid col1 gap">
            <div class="grid col1 box">
                <h2>Abilities</h2>
                <div class="grid col3 abilities smallgap">
                    <button type="roll"
                        value="&{template:test} {{name=@{character_name}}} {{ability=Prowess}} {{result=[[1d6 + @{prowess}]]}}"
                        name="roll_prowess"><label>Prowess</label></button>
                    <input type="hidden" name="attr_prowess_adjective" value="Weak" />
                    <span class="input" name="attr_prowess_adjective" />
                    <input type="number" name="attr_prowess" value="1" />

                    <button type="roll"
                        value="&{template:test} {{name=@{character_name}}} {{ability=Coordination}} {{result=[[1d6 + @{coordination}]]}}"
                        name="roll_coordination"><label>Coordination</label></button>
                    <input type="hidden" name="attr_coordination_adjective" value="Weak" />
                    <span class="input" name="attr_coordination_adjective" />
                    <input type="number" name="attr_coordination" value="1" />

                    <button type="roll"
                        value="&{template:test} {{name=@{character_name}}} {{ability=Strength}} {{result=[[1d6 + @{strength}]]}}"
                        name="roll_strength"><label>Strength</label></button>
                    <input type="hidden" name="attr_strength_adjective" value="Weak" />
                    <span class="input" name="attr_strength_adjective" />
                    <input type="number" name="attr_strength" value="1" />

                    <button type="roll"
                        value="&{template:test} {{name=@{character_name}}} {{ability=Intellect}} {{result=[[1d6 + @{intellect}]]}}"
                        name="roll_intellect"><label>Intellect</label></button>
                    <input type="hidden" name="attr_intellect_adjective" value="Weak" />
                    <span class="input" name="attr_intellect_adjective" />
                    <input type="number" name="attr_intellect" value="1" />

                    <button type="roll"
                        value="&{template:test} {{name=@{character_name}}} {{ability=Awareness}} {{result=[[1d6 + @{awareness}]]}}"
                        name="roll_awareness"><label>Awareness</label></button>
                    <input type="hidden" name="attr_awareness_adjective" value="Weak" />
                    <span class="input" name="attr_awareness_adjective" />
                    <input type="number" name="attr_awareness" value="1" />

                    <button type="roll"
                        value="&{template:test} {{name=@{character_name}}} {{ability=Willpower}} {{result=[[1d6 + @{willpower}]]}}"
                        name="roll_willpower"><label>Willpower</label></button>
                    <input type="hidden" name="attr_willpower_adjective" value="Weak" />
                    <span class="input" name="attr_willpower_adjective" />
                    <input type="number" name="attr_willpower" value="1" />
                </div>
            </div>

            <div class="grid col1 box">
                <h2>Specialties</h2>
                <fieldset class="repeating_specialties grid col1 smallgap">
                    <div class="grid col3">
                        <input type="text" name="attr_name" placeholder="Speciality" />
                        <select name="attr_level">
                            <option value="1"></option>
                            <option value="2">Expert</option>
                            <option value="3">Master</option>
                        </select>
                        <button type="roll"
                            value="&{template:test} {{name=@{character_name}}} {{ability=@{name}}} {{ability_choice=[[?{Ability|Prowess, @{prowess}|Coordination, @{coordination}|Strength, @{strength}|Intellect, @{intellect}|Awareness, @{awareness}|Willpower, @{willpower}}]]}} {{result=[[1d6+?{Ability}+@{level}]]}}"
                            name="roll_specialty" />
                    </div>
                </fieldset>
            </div>

            <div class="grid col1 box">
                <h2>Qualities</h2>
                <fieldset class="repeating_qualities grid col1 smallgap">
                    <input type="text" name="attr_name" placeholder="Quality" />
                </fieldset>
            </div>
        </div>

        <div class="grid col1 gap">
            <div class="grid col1 box">
                <h2>Powers</h2>
                <fieldset class="repeating_powers grid col1 smallgap">
                    <div class="grid col3">
                        <input class="label" type="text" name="attr_name" placeholder="Power name" />
                        <button type="roll"
                            value="&{template:test} {{name=@{character_name}}} {{ability=@{name}}} {{result=[[1d6+@{level}]]}}"
                            name="roll_power" />
                        <input type="hidden" name="attr_adjective" value="Weak" />
                        <span class="input" name="attr_adjective" />
                        <input type="number" name="attr_level" value="1" />
                        <span />
                        <input type="text" name="attr_description" placeholder="Extras, limits, etc." />
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</div>

<script type="text/worker">
    const adjectives_list = ['Weak','Poor','Average','Fair','Good','Great',
        'Incredible','Amazing','Fantastic','Supreme'];
    const abilities_list = ['prowess','coordination','strength','intellect',
        'awareness','willpower'];

    abilities_list.forEach(ability => {
        on(`change:${ability}`, function(eventInfo) {
            getAttrs(abilities_list, function(values) {
                let update = {};
                let level = parseInt(values[ability])||0;
                let strength = parseInt(values['strength'])||0;
                let willpower = parseInt(values['willpower'])||0;
                update[`${ability}_adjective`] = adjectives_list[level - 1];
                update['stamina_max'] = strength + willpower;
                setAttrs(update);
            });
        });
    });

    on('change:repeating_powers:level', function(eventInfo) {
        getAttrs(['repeating_powers_level'], function(values) {
            let update = {};
            let level = parseInt(values['repeating_powers_level'])||0;
            update['repeating_powers_adjective'] = adjectives_list[level - 1];
            setAttrs(update);
        });
    });
</script>

<rolltemplate class="sheet-rolltemplate-test">
    <div class="container">
        <h1>{{name}} tests {{ability}}!</h1>
        <p>{{result}}</p>
    </div>
</rolltemplate>
